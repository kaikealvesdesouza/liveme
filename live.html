<html data-bs-theme="dark">
	<head>
	 <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>live me</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
		<script type="text/javascript" src="sites.js"></script>	
		<script type="text/javascript" src="request.js"></script>	
		<style>
		.mform-control{
		  padding: 0.375rem 0.75rem;
		  font-size: 1rem;
		  font-weight: 400;
		  line-height: 1.5;
		  color: var(--bs-body-color);
		  background-color: var(--bs-body-bg);
		  background-clip: padding-box;
		  border: var(--bs-border-width) solid var(--bs-border-color);
		  -webkit-appearance: none;
		  -moz-appearance: none;
		  appearance: none;
		  border-radius: var(--bs-border-radius);
		  transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
		}
		
		</style>	
	</head>
	<body>

	<div style="width:800px; margin:auto;">
		<div>
			<div style="height:50px;">
				<a href="live.html">In√≠cio</a>
			</div>
			<form onsubmit="return false;">
				<div style="">
				<input type="text"  class="mform-control" type="text" id="search" name="search">
			<button class="btn btn-success" onclick="submf()">pesquisar</button>	
				</div>				
			</form>
		</div>
		<div id="suggestions"></div>
		<div id="resultado"></div>
		<div style="position:fixed;bottom:0px;" id="paginacao"></div>
	</div>
	<script type="text/javascript">
			var url       = new URL(window.location.href);
      var page      = url.searchParams.get("page");
      var search    = url.searchParams.get("search");
      var skeys     = Object.keys(sites);
    	var nofsites  = Object.keys(sites).length;
    	var sitesppage= 1;
    	var nofpages  = nofsites/sitesppage;
    if(!page){
    	page=1;
    }else{
    	page=parseInt(page);
    }
    if(page<=0){
    	page=1;
    }
    if(page>nofpages){
    	page=nofpages;
    }
		var myWindow;
	 	function openM(event,a){
	 		 event.preventDefault();
	 		myWindow = window.open(a.href, "live me", "width=400,height=300");
	 	}  
	  function li(item,search){
	  	let html =  "<div>";
	  	    html += "<h4>" + item.title + "</h4>";
	  	    html += "<p class='truncate'>" + item.abstract + "</p>";
	  	    pstr = "";
	  	    for(let i=0;i<item.params.length;i++)
	  	    {
	  	    		if(item.params[i].f == "search"){
	  	    			pstr += item.params[i].name + "=" + search;
	  	    		}
	  	    }
	  	    html += "<a onclick='openM(event,this);return false;' href='https://www."+item.url+"/"+item.search+"/"+search+ "?"+ pstr + "'>" + item.title +"->"+"pesquisar" +"->"+ search+ "</a>"
	  			html +="</div>";
	  	return html;
	  }
	  
	  function submf(v){
	  	search=document.getElementById("search").value;
	  	page=1;
	  	var title  = "live me - " + search + " "      + page;
	  	var target = "?search="  + search + "&page=" + page;
			window.history.pushState({}, title, target);
			wiki(search);
			list();
	  }
	  
	  
		function list(){ 
			let html = "";
			let pkeys=skeys.slice(page-1,(page-1)+sitesppage);
			for(let i=0;i< pkeys.length;i++)
	  	{
	  		html += li(sites[pkeys[i]],search);
	  	}
	  	document.getElementById("resultado").innerHTML = html;
	  	document.getElementById("paginacao").innerHTML = pagination();
		}
		
		function pagination(){
			let html = "<div class='pagination'>";
			for(let i=1;i<nofpages+1;i++)
			{
				if(i==page){
				html += "<li  class='page-item active'><a onclick='go(event,this);return false;' class='page-link' href='?search="+search+"&page="+i+"'>"+i+"</a></li>";
				}else{
				html += "<li  class='page-item'><a onclick='go(event,this);return false;' class='page-link' href='?search="+search+"&page="+i+"'>"+i+"</a></li>";
				}
			}
			html += "</div>";
			return html;
			
		}
		
		
	  function go(e,a){
	  	e.preventDefault;
	  	let url    = new URL(a.href);
          search = url.searchParams.get("search");
          page   = url.searchParams.get("page");
	  	var title  = "live me - " + search + " "      + page;
	  	var target = "?search="   + search + "&page=" + page;
			window.history.pushState({}, title, target);
	  	
	  	list();
	  }
	  console.log("entoeru");
	  
	  window.onpopstate = (event) => {
			console.log(
				`location: ${document.location}, state: ${JSON.stringify(event.state)}`
			);
			window.location.href=document.location;
		};


		if(search){
			document.getElementById("search").value=search;    
			list();
		}
		  	
	</script>
		
	</body>
	</html>
